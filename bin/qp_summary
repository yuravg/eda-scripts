#!/usr/bin/env bash

# Show Quartus Prime compilation summary

MSG="Fitter summary:"
printf "%b%s%b\n" "\e[32m" "$MSG" "\e[0m"

if [ "$(ls -A output_files)" ]; then
    OUTDIR="./output_files/"
else
    OUTDIR=""
fi

cat "$OUTDIR"*fit.summary 2>/dev/null

# End time and compile time:
echo "------------------------------------------"
START=$(cat "$OUTDIR"*.map.rpt 2>/dev/null | grep -e 'Processing started:' | sed 's/.*Processing started:\s-*//')
DONE=$(cat "$OUTDIR"*done 2>/dev/null)

START_TIME=$(echo $START | sed 's/\(.*\) \([0-9]\+:[0-9]\+:[0-9]\+\)\(.*\)/\2/')
DONE_TIME=$(echo $DONE | sed 's/\(.*\) \([0-9]\+:[0-9]\+:[0-9]\+\)\(.*\)/\2/')
START_DATE=$(date -u -d "$START_TIME" +"%s")
DONE_DATE=$(date -u -d "$DONE_TIME" +"%s")
DELTA=$(date -u -d "0 $DONE_DATE sec - $START_DATE sec" +"%H:%M:%S")
echo "Done : $DONE ($DELTA)"
